<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kraftory PH QR Scanner</title>
<style>
body {
  margin:0;
  font-family:sans-serif;
  text-align:center;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  height:100vh;
  background:#000;
  color:#fff;
  padding:10px;
}
.logo { max-width:200px; height:auto; margin:15px auto; }
#reader { width:100%; max-width:400px; margin:auto; }
.back-btn {
  margin-top:15px;
  padding:10px 20px;
  font-size:16px;
  background:#ff6600;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.back-btn:hover { background:#e65c00; }
.unsupported {
  margin-top:50px;
  font-size:1.1em;
  color:#ffcc00;
  line-height:1.4;
  padding:0 10px;
}
</style>
</head>
<body>
<img src="logo.png" alt="Kraftory PH Logo" class="logo">
<div id="reader"></div>
<button class="back-btn" onclick="location.href='index.html'">⬅ Back</button>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
// Strict iOS Safari detection
function isIosSafari() {
    const ua = navigator.userAgent;
    const iOS = /iPad|iPhone|iPod/.test(ua);
    const safari = /Safari/.test(ua);
    // Exclude Chrome, Firefox, Edge, Brave
    const isWebKitWrapper = /CriOS|FxiOS|EdgiOS|Brave/i.test(ua);
    return iOS && safari && !isWebKitWrapper;
}

const html5QrCode = new Html5Qrcode("reader");

html5QrCode.start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    qrCodeMessage => {
        if (isIosSafari()) {
            // Redirect to USDZ file in root
            window.location.href = qrCodeMessage;
        } else {
            // Stop scanner and show unsupported message
            html5QrCode.stop().catch(err => console.error(err));
            document.body.innerHTML = `
                <img src="logo.png" class="logo" alt="Kraftory PH Logo">
                <div class="unsupported">
                    AR view is limited to iOS Safari.<br>
                    Please open this page on an iPhone or iPad using Safari to view products in AR.<br>
                    – Kraftory PH
                </div>
                <button class="back-btn" onclick="location.href='index.html'">⬅ Back</button>
            `;
        }
    },
    errorMessage => {}
).catch(err => console.error(err));
</script>
</body>
</html>
